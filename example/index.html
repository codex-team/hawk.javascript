<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hawk JavaScript example</title>
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,500,700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: Roboto, system-ui, sans-serif;
            margin: 0;
            padding: 0;
            background: #2F3341;
            color: #DBE6FF;
            font-size: 13px;
        }

        header {
            padding: 30px;
            background: #242732;
        }

        h1 {
            font-weight: bold;
            font-size: 20px;
            margin: 0 0 15px;
        }

        a {
            color: inherit;
        }

        section {
            padding: 15px;
            border: 1px solid rgba(219,230,255,0.10);
            border-radius: 4px;
            margin: 15px;
        }

        h2 {
            font-weight: 500;
            margin: 0 0 10px;
            font-size: 13px;
            color: rgba(219,230,255,0.60);
            letter-spacing: 0.24px;
            text-align: left;
            text-transform: uppercase;
        }

        h2 small {
          text-transform: none;
          font-size: 14px;
          opacity: .6;
          font-weight: normal;
          margin-left: 15px;
        }

        button {
            display: inline-block;
            padding: 8px 20px;
            border: 0;
            border-radius: 5px;
            background: #4979E4;
            color: #DBE6FF;
            font-weight: 500;
            font-size: 14px;
            cursor: pointer;
        }

        button:hover {
            background: #4869d2;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-size: 15px;
        }

        input, select {
            background: rgba(36,39,50,0.68);
            border: 1px solid rgba(0,0,0,0.18);
            border-radius: 3px;
            padding: 10px 15px;
            font-size: 15px;
            color:inherit;
        }

        .performance-demo {
            border-radius: 4px;
        }

        .performance-demo button {
            padding: 8px 16px;
            padding-right: 32px;
            background: #4979E4;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            position: relative;
            min-width: 200px;
            text-align: left;
        }

        .performance-demo button:hover {
            background: #4869d2;
        }

        .performance-demo button[disabled] {
            background: #4979E4;
            opacity: 0.7;
            cursor: not-allowed;
        }

        .performance-demo button .spinner {
            display: none;
            width: 10px;
            height: 10px;
            border: 2px solid #fff;
            border-bottom-color: transparent;
            border-radius: 50%;
            animation: rotation 1s linear infinite;
            position: absolute;
            right: 10px;
            top: 50%;
            margin-top: -5px;
        }

        #sampleRate, #batchInterval, #generateTransactions {
          margin-bottom: 10px;
        }

        .performance-demo button[disabled] .spinner {
            display: block;
        }

        @keyframes rotation {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>
<body>
<header>
    <h1>
        Hawk JavaScript Catcher
    </h1>
    <a href="https://github.com/codex-team/hawk.javascript">https://github.com/codex-team/hawk.javascript</a>
</header>
<section>
    <h2>Send test event</h2>
    <button onclick="window.hawk.test()">hawk.test()</button>
</section>
<section>
    <h2>Send real error</h2>
    <button id="btn-real-error">Real error</button>
</section>
<section>
    <h2>Send Unhandled promise rejection error</h2>
    <button id="btn-promise-rejection">
        Unhandled promise rejection
    </button>
</section>
<section>
  <h2>
    Send event manually
    <small>
      Through the <code>.send(error, context)</code> method
    </small>
  </h2>
  <label for="errorContext">Error context</label>
  <input type="text" id="errorContext" placeholder="Any data you want">
  <br>
  <br>
  <button id="btn-manual-sending">
    Send manual message
  </button>
</section>
<section>
    <h2>Send the specified number of errors</h2>
    <label for="errorsNumber">Enter the number of errors to send</label>
    <input type="number" id="errorsNumber" value="1000">
    <br><br>
    <label for="errorType">Select errors type</label>
    <select id="errorType">
        <option value="TypeError">TypeError</option>
        <option value="RangeError">RangeError</option>
        <option value="Error">Error</option>
    </select>
    <br><br>
    <button id="btn-send-many">Send errors</button>
</section>
<section>
    <h2>Test console catcher</h2>
    <label for="consoleCatcherTestTextInput">Enter text</label>
    <input type="text" id="consoleCatcherTestTextInput">
    <br><br>
    <label for="consoleMethod" style="display: inline">console.</label>
    <select id="consoleMethod">
        <option value="log">log</option>
        <option value="error">error</option>
        <option value="info">info</option>
        <option value="debug">debug</option>
        <option value="warn">warn</option>
    </select>
    <br><br>
    <button id="btn-console-test">Make</button>
</section>
<section>
    <h2>Performance Monitoring Demo</h2>
    <div class="performance-demo">
        <button id="simulateComplexOperation">
            Simulate Complex Operation
            <span class="spinner"></span>
        </button>
    </div>
</section>
<section>
    <h2>Performance Monitoring Settings Demo</h2>
    <div class="performance-demo">
      <div class="input-group">
        <label for="sampleRate">Sample Rate (0-1):</label>
        <input 
          type="number" 
          id="sampleRate" 
          value="1.0" 
          min="0" 
          max="1" 
          step="0.1"
          oninput="updateSampleRate(this.value)"
        >
        <label for="batchInterval">Batch Interval (ms):</label>
        <input 
          type="number" 
          id="batchInterval" 
          value="3000" 
          min="1000" 
          step="1000"
          oninput="updateBatchInterval(this.value)"
        >
      </div>
      <div>
        <button id="generateTransactions">
          Generate 100 Transactions
          <span class="spinner"></span>
        </button>
        <div id="transactionStats">
          Sampled: 0 / Total: 0
        </div>
        <div id="batchStats">
          Last batch sent: Never
        </div>
      </div>
    </div>
</section>
<!-- <script src="https://unpkg.com/vue@2"></script> -->
<script src="https://cdn.jsdelivr.net/npm/vue@2.7.16/dist/vue.js"></script>
<section>
    <h2>Test Vue integration: $root</h2>
    <div id="vue-app-1">
        <button @click="buttonClicked">{{ label }}</button>
    </div>
    <script>
      new Vue({
        el: '#vue-app-1',
        data: {
          label: 'Error in Vue $root'
        },
        methods:{
          buttonClicked(){
            foo();
          }
        }
      })
    </script>
</section>
<section>
    <h2>Test Vue integration: &lt;test-component&gt;</h2>
    <div id="vue-app-2">
        <test-component :title="label"/>
    </div>
    <script>
      class Editor {}

      const tag = document.createElement('div');

      tag.classList.add('my-class', 'my-class--second');
      tag.setAttribute('title', 'My title');
      tag.dataset.index = 123;
      tag.innerHTML = document.body.innerHTML;

      Vue.component('test-component', {
        data(){
          return {
            number: 1,
            bool: false,
            arr: [1,2,3, [new Editor(), tag.cloneNode()], {foo: 'bar'}],
            el: tag,
            instance: new Editor(),
            classProto: Editor,
            longText: 'Upvoting this, given it\'s simplicity. In my use case I need to check all the attributes in an object for dodgy values-NaNs, nulls, undefined (they were points on a graph and these values prevented the graph from drawing). To get the value instead of the name, in the loop you would just do obj[someVariable]. Perhaps the reason it was downvoted so much is because it is not recursive. So this would not be an adequate solution if you have a highly structured object.Upvoting this, given it\'s simplicity. In my use case I need to check all the attributes in an object for dodgy values-NaNs, nulls, undefined (they were points on a graph and these values prevented the graph from drawing). To get the value instead of the name, in the loop you would just do obj[someVariable]. Perhaps the reason it was downvoted so much is because it is not recursive. So this would not be an adequate solution if you have a highly structured object.Upvoting this, given it\'s simplicity. In my use case I need to check all the attributes in an object for dodgy values-NaNs, nulls, undefined (they were points on a graph and these values prevented the graph from drawing). To get the value instead of the name, in the loop you would just do obj[someVariable]. Perhaps the reason it was downvoted so much is because it is not recursive. So this would not be an adequate solution if you have a highly structured object.Upvoting this, given it\'s simplicity. In my use case I need to check all the attributes in an object for dodgy values-NaNs, nulls, undefined (they were points on a graph and these values prevented the graph from drawing). To get the value instead of the name, in the loop you would just do obj[someVariable]. Perhaps the reason it was downvoted so much is because it is not recursive. So this would not be an adequate solution if you have a highly structured object.Upvoting this, given it\'s simplicity. In my use case I need to check all the attributes in an object for dodgy values-NaNs, nulls, undefined (they were points on a graph and these values prevented the graph from drawing). To get the value instead of the name, in the loop you would just do obj[someVariable]. Perhaps the reason it was downvoted so much is because it is not recursive. So this would not be an adequate solution if you have a highly structured object.Upvoting this, given it\'s simplicity. In my use case I need to check all the attributes in an object for dodgy values-NaNs, nulls, undefined (they were points on a graph and these values prevented the graph from drawing). To get the value instead of the name, in the loop you would just do obj[someVariable]. Perhaps the reason it was downvoted so much is because it is not recursive. So this would not be an adequate solution if you have a highly structured object.Upvoting this, given it\'s simplicity. In my use case I need to check all the attributes in an object for dodgy values-NaNs, nulls, undefined (they were points on a graph and these values prevented the graph from drawing). To get the value instead of the name, in the loop you would just do obj[someVariable]. Perhaps the reason it was downvoted so much is because it is not recursive. So this would not be an adequate solution if you have a highly structured object.Upvoting this, given it\'s simplicity. In my use case I need to check all the attributes in an object for dodgy values-NaNs, nulls, undefined (they were points on a graph and these values prevented the graph from drawing). To get the value instead of the name, in the loop you would just do obj[someVariable]. Perhaps the reason it was downvoted so much is because it is not recursive. So this would not be an adequate solution if you have a highly structured object.Upvoting this, given it\'s simplicity. In my use case I need to check all the attributes in an object for dodgy values-NaNs, nulls, undefined (they were points on a graph and these values prevented the graph from drawing). To get the value instead of the name, in the loop you would just do obj[someVariable]. Perhaps the reason it was downvoted so much is because it is not recursive. So this would not be an adequate solution if you have a highly structured object.Upvoting this, given it\'s simplicity. In my use case I need to check all the attributes in an object for dodgy values-NaNs, nulls, undefined (they were points on a graph and these values prevented the graph from drawing). To get the value instead of the name, in the loop you would just do obj[someVariable]. Perhaps the reason it was downvoted so much is because it is not recursive. So this would not be an adequate solution if you have a highly structured object.Upvoting this, given it\'s simplicity. In my use case I need to check all the attributes in an object for dodgy values-NaNs, nulls, undefined (they were points on a graph and these values prevented the graph from drawing). To get the value instead of the name, in the loop you would just do obj[someVariable]. Perhaps the reason it was downvoted so much is because it is not recursive. So this would not be an adequate solution if you have a highly structured object.Upvoting this, given it\'s simplicity. In my use case I need to check all the attributes in an object for dodgy values-NaNs, nulls, undefined (they were points on a graph and these values prevented the graph from drawing). To get the value instead of the name, in the loop you would just do obj[someVariable]. Perhaps the reason it was downvoted so much is because it is not recursive. So this would not be an adequate solution if you have a highly structured object.',
          }
        },
        props: {
          title: String,
        },
        computed: {
          changedItem(){
            return this.number + 1;
          }
        },
        template: '<button @click="buttonClicked" :data-item="number" data-changed-item="changedItem">{{ title }} - {{ changedItem }}</button>',
        methods: {
          buttonClicked(){
            bar();
          }
        }
      });

      new Vue({
        el: '#vue-app-2',
        data: {
          label: 'Error in Vue-component'
        },
      })
    </script>
</section>
<script src="sample-errors.js"></script>
<script type="module">
  import HawkCatcher from '../src';

  window.hawk = new HawkCatcher({
    token: 'eyJpbnRlZ3JhdGlvbklkIjoiNWU5OTE1MzItZTdiYy00ZjA0LTliY2UtYmIzZmE5ZTUwMTg3Iiwic2VjcmV0IjoiMTBlMTA4MjQtZTcyNC00YWFkLTkwMDQtMzExYTU1OWMzZTIxIn0=',
    // collectorEndpoint: 'ws://localhost:3000/ws',
    vue: window.Vue,
    context: {
      rootContextSample: '12345'
    },
    performance: true
  })
</script>
<script type="module">
  import HawkCatcher from '../src';
  // Simulate complex operation with nested spans
  document.getElementById('simulateComplexOperation').addEventListener('click', () => {
    const button = document.getElementById('simulateComplexOperation');
    button.disabled = true;

    const transaction = window.hawk.startTransaction('complex-operation', {
      type: 'background'
    });

    const step1 = transaction.startSpan('step-1');
    setTimeout(() => {
      step1.finish();

      const step2 = transaction.startSpan('step-2');
      // Simulate unfinished span
      
      const step3 = transaction.startSpan('step-3');
      setTimeout(() => {
        step3.finish();
        transaction.finish();
        button.disabled = false;
      }, 300);
    }, 400);
  });

  // Function to update sample rate
  window.updateSampleRate = (value) => {
    const rate = parseFloat(value);
    const interval = parseInt(document.getElementById('batchInterval').value);
    
    window.hawk = new HawkCatcher({
      token: 'eyJpbnRlZ3JhdGlvbklkIjoiNWU5OTE1MzItZTdiYy00ZjA0LTliY2UtYmIzZmE5ZTUwMTg3Iiwic2VjcmV0IjoiMTBlMTA4MjQtZTcyNC00YWFkLTkwMDQtMzExYTU1OWMzZTIxIn0=',
      performance: {
        sampleRate: rate,
        batchInterval: interval
      }
    });
  };

  // Function to update batch interval
  window.updateBatchInterval = (value) => {
    const interval = parseInt(value);
    const rate = parseFloat(document.getElementById('sampleRate').value);
    
    window.hawk = new HawkCatcher({
      token: 'eyJpbnRlZ3JhdGlvbklkIjoiNWU5OTE1MzItZTdiYy00ZjA0LTliY2UtYmIzZmE5ZTUwMTg3Iiwic2VjcmV0IjoiMTBlMTA4MjQtZTcyNC00YWFkLTkwMDQtMzExYTU1OWMzZTIxIn0=',
      performance: {
        sampleRate: rate,
        batchInterval: interval
      }
    });
  };

  // Test sampling and throttling
  let totalTransactions = 0;
  let sampledTransactions = 0;
  let lastBatchTime = null;

  document.getElementById('generateTransactions').addEventListener('click', async () => {
    const button = document.getElementById('generateTransactions');
    button.disabled = true;
    
    // Reset counters
    totalTransactions = 0;
    sampledTransactions = 0;
    
    // Generate transactions rapidly
    for (let i = 0; i < 100; i++) {
      totalTransactions++;
      
      const transaction = window.hawk.startTransaction(`test-${i}`, {
        type: 'test'
      });

      // Add some spans
      const span1 = transaction.startSpan('span-1');
      await new Promise(resolve => setTimeout(resolve, 50));
      span1.finish();

      const span2 = transaction.startSpan('span-2');
      await new Promise(resolve => setTimeout(resolve, 50));
      span2.finish();

      // Check if transaction was sampled
      if (transaction.finish.toString().includes('queueTransaction')) {
        sampledTransactions++;
      }

      transaction.finish();

      // Update stats
      document.getElementById('transactionStats').textContent = 
        `Sampled: ${sampledTransactions} / Total: ${totalTransactions}`;
    }

    button.disabled = false;
  });

  // Monitor WebSocket messages to detect batches
  const originalSend = WebSocket.prototype.send;
  WebSocket.prototype.send = function(data) {
    const message = JSON.parse(data);
    if (message.catcherType === 'performance') {
      lastBatchTime = new Date();
      document.getElementById('batchStats').textContent = 
        `Last batch sent: ${lastBatchTime.toLocaleTimeString()} (${message.payload.transactions.length} transactions)`;
    }
    return originalSend.call(this, data);
  };
</script>
</body>
</html>
